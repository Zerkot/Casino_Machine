<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-t"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Solde de la Machine √† Sous</title>
<style>
        /* ... (Styles CSS identiques √† la version pr√©c√©dente) ... */
        body {
            height: 200vh;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            transition: background-color 0.5s;
        }

        #balance-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            font-size: 1.5em;
            font-weight: bold;
            font-family: Arial, sans-serif;
            z-index: 1000;
        }

        #balance-container button {
            margin-left: 10px;
            font-size: 0.7em;
            padding: 5px 8px;
            vertical-align: middle;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: #333;
        }

        #rules-button {
            background-color: #17a2b8;
            color: white;
            font-weight: bold;
        }
        #rules-button:hover { background-color: #117a8b; }

        #settings-button {
            background-color: #6c757d;
            color: white;
            font-weight: bold;
        }
        #settings-button:hover { background-color: #5a6268; }

        #cheat-button {
            background-color: #888;
            color: white;
            display: none;
        }
        #cheat-button:hover { background-color: #666; }

        #logout-button {
            background-color: #dc3545;
            color: white;
            font-weight: bold;
        }
        #logout-button:hover { background-color: #c82333; }

        #test-button {
            background-color: #f39c12;
            color: white;
            display: none;
        }
        #test-button:hover { background-color: #e67e22; }

        #spin-button {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #007bff;
            color: white;
            font-size: 2.5em;
            font-weight: bold;
            padding: 20px 50px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transition: background-color 0.2s, transform 0.1s;
        }
        #spin-button:hover { background-color: #0056b3; }
        #spin-button:active { transform: translateX(-50%) scale(0.95); }
        #spin-button:disabled { background-color: #555; cursor: not-allowed; box-shadow: none; transform: translateX(-50%); }

        #slot-container {
            width: 90%;
            max-width: 600px;
            margin: 80px auto 0 auto;
            background: #2c3e50;
            border: 10px solid #f1c40f;
            border-radius: 15px;
            padding: 20px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.5);
            transition: border-color 0.5s, background-color 0.5s;
        }

        #reels-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            background: #ffffff;
            padding: 10px;
            border-radius: 5px;
            border: 3px solid #7f8c8d;
        }

        .symbol {
            font-size: 3em;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ecf0f1;
            border-radius: 5px;
            min-height: 80px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.1s ease-out, background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s;
            position: relative; /* NOUVEAU: Pour z-index */
            /* Note: Pour utiliser des images, modifiez le JS (voir stopColumn) 
               et d√©commentez/ajustez ces styles :
            */
            /*
            padding: 5px; 
            font-size: 1em; 
            */
        }
        /*
        .symbol img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        */
        .symbol.spinning {
            opacity: 0.6;
            filter: blur(2px);
            transform: scale(0.9);
        }
        
        /* NOUVEAU : Style de surbrillance */
        .symbol.winning-symbol {
            background-color: #f1c40f; /* Or */
            color: #333;
            border: 3px solid #e67e22; /* Bordure orange */
            transform: scale(1.1);
            box-shadow: 0 0 15px 5px #f1c40f;
            z-index: 10;
        }

        body.dark-mode .symbol.winning-symbol {
            background-color: #ffd700; /* Or plus vif */
            color: #111;
            border-color: #f39c12;
            box-shadow: 0 0 15px 5px #ffd700;
        }
        /* FIN NOUVEAU */


        #bet-controls {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 10px;
            font-family: Arial, sans-serif;
        }
        #bet-controls button {
            font-size: 1.5em;
            font-weight: bold;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #007bff;
            background-color: white;
            color: #007bff;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
            vertical-align: middle;
        }
        #bet-controls button:hover { background-color: #007bff; color: white; }
        #bet-controls button:disabled { background-color: #ccc; color: #888; border-color: #ccc; cursor: not-allowed; }

        #bet-input {
            font-size: 1.8em;
            font-weight: bold;
            width: 100px;
            text-align: center;
            margin: 0 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
            vertical-align: middle;
            -moz-appearance: textfield;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        #bet-input::-webkit-outer-spin-button,
        #bet-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        #result-display {
            text-align: center;
            font-family: Arial, sans-serif;
            font-size: 1.8em;
            font-weight: bold;
            margin-top: 20px;
            padding: 15px;
            color: #333;
            transition: color 0.3s, transform 0.3s;
        }
        #result-display.win { color: #2ecc71; transform: scale(1.1); }
        #result-display.lose { color: #95a5a6; }
        #result-display.jackpot { color: #f1c40f; transform: scale(1.2); font-size: 2.2em; }

        #test-log {
            margin: 20px auto;
            max-width: 600px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: none;
            font-family: Arial, sans-serif;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
        }

        .modal-content {
            background-color: #fff;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 500px;
            position: relative;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2.2em;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s;
        }
        .modal-close:hover { color: #333; }

        .modal-content h2 {
            margin-top: 0;
            color: #007bff;
            border-bottom: 2px solid #f4f4f9;
            padding-bottom: 10px;
            transition: color 0.3s, border-color 0.3s;
        }

        .modal-content h3 {
            margin-top: 20px;
            color: #2c3e50;
            transition: color 0.3s;
        }

        .modal-content p {
            font-size: 1.1em;
            line-height: 1.6;
        }

        #payout-list {
            list-style-type: none;
            padding-left: 0;
            margin-top: 15px;
        }

        #payout-list li {
            font-size: 1.2em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 8px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #payout-list li span {
            font-size: 1.6em;
            margin-right: 15px;
            display: inline-block;
            width: 40px;
            text-align: center;
        }

        #dark-mode-toggle {
            font-size: 1em;
            padding: 10px 15px;
            width: 100%;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        #dark-mode-toggle:hover { background-color: #0056b3; }

        @keyframes frenzy-border-flash {
            0% { border-color: #e74c3c; }
            50% { border-color: #f39c12; }
            100% { border-color: #e74c3c; }
        }

        body.frenzy-mode {
            background-color: #4A235A;
        }

        .frenzy-mode #slot-container {
            background: #6C3483;
            animation: frenzy-border-flash 0.8s infinite linear;
        }

        .frenzy-mode #spin-button {
            background-color: #e74c3c;
        }

        .frenzy-mode #spin-button:hover {
            background-color: #c0392b;
        }

        #frenzy-display {
            position: fixed;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.5em;
            font-weight: bold;
            font-family: Arial, sans-serif;
            z-index: 999;
            display: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /*
        ==============================================
        CORRIG√â : STYLES DU MODE SOMBRE
        ==============================================
        */
        body.dark-mode {
            background-color: #1a1a2e;
        }

        body.dark-mode #balance-container {
            background-color: #004a99;
            color: #e0e0e0;
        }

        body.dark-mode #balance-container button {
            color: #ddd;
        }

        body.dark-mode #rules-button {
            background-color: #106a7a;
            color: white;
        }
        body.dark-mode #rules-button:hover { background-color: #0d5663; }

        body.dark-mode #settings-button {
            background-color: #4a5157;
            color: white;
        }
        body.dark-mode #settings-button:hover { background-color: #383d41; }

        body.dark-mode #cheat-button {
            background-color: #444;
            color: white;
        }
        body.dark-mode #cheat-button:hover { background-color: #222; }

        body.dark-mode #test-button {
            background-color: #a0680a;
            color: white;
        }
        body.dark-mode #test-button:hover { background-color: #805308; }

        body.dark-mode #spin-button {
            background-color: #0056b3;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode #spin-button:hover { background-color: #003d80; }
        body.dark-mode #spin-button:disabled { background-color: #333; }

        body.dark-mode #slot-container {
            background: #1f2c3a;
            border-color: #b88a0b;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.7), 0 10px 20px rgba(0,0,0,0.7);
        }

        body.dark-mode #reels-container {
            background: #333;
            border-color: #555;
        }

        body.dark-mode .symbol {
            background-color: #5a6a7a;
            color: #fff;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }

        body.dark-mode #bet-controls button {
            background-color: #444;
            color: #00aaff;
            border-color: #00aaff;
        }

        body.dark-mode #bet-controls button:hover {
            background-color: #00aaff;
            color: #111;
        }

        body.dark-mode #bet-controls button:disabled {
            background-color: #222;
            color: #555;
            border-color: #444;
        }

        body.dark-mode #bet-input {
            background-color: #555;
            color: #fff;
            border-color: #777;
        }

        body.dark-mode #result-display {
            color: #ddd;
        }
        body.dark-mode #result-display.win { color: #30f080; }
        body.dark-mode #result-display.lose { color: #88999a; }
        body.dark-mode #result-display.jackpot { color: #ffd700; }

        body.dark-mode #test-log {
            background: #333;
            color: #ddd;
            border-color: #555;
        }

        body.dark-mode .modal-content {
            background-color: #2c3e50;
            color: #ddd;
        }

        body.dark-mode .modal-close {
            color: #777;
        }
        body.dark-mode .modal-close:hover {
            color: #fff;
        }

        body.dark-mode .modal-content h2 {
            color: #00aaff;
            border-bottom-color: #445;
        }

        body.dark-mode .modal-content h3 {
            color: #aaa;
        }

        body.dark-mode #payout-list li {
            background: #3a4b5c;
            border-color: #555;
        }

        body.dark-mode #dark-mode-toggle {
            background-color: #00aaff;
            color: #111;
        }
        body.dark-mode #dark-mode-toggle:hover {
            background-color: #0077cc;
        }

        /* CORRIG√â : S√©lecteurs combin√©s pour Fr√©n√©sie + Mode Sombre */
        body.dark-mode.frenzy-mode {
            background-color: #2a133a;
        }

        body.dark-mode.frenzy-mode #slot-container {
            background: #4a1e5c;
        }

        body.dark-mode.frenzy-mode #spin-button {
            background-color: #b02a1b;
        }

        body.dark-mode.frenzy-mode #spin-button:hover {
            background-color: #902115;
        }

        #back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-size: 1em;
            font-weight: bold;
            text-decoration: none;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        #back-button:hover {
            background: linear-gradient(135deg, #2980b9, #3498db);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.35);
        }

        #auth-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #auth-container h2 {
            margin-top: 0;
            color: #333;
        }
        #auth-container button {
            font-size: 1.2em;
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #login-button { background-color: #007bff; color: white; }
        #login-button:hover { background-color: #0056b3; }
        #register-button { background-color: #28a745; color: white; }
        #register-button:hover { background-color: #1e7e34; }

        body.dark-mode #auth-container {
            background: #2c3e50;
        }
        body.dark-mode #auth-container h2 {
            color: #f4f4f9;
        }
        body.dark-mode #login-button { background-color: #0056b3; }
        body.dark-mode #login-button:hover { background-color: #003d80; }
        body.dark-mode #register-button { background-color: #1e7e34; }
        body.dark-mode #register-button:hover { background-color: #155724; }

        #user-info {
            font-size: 0.7em;
            font-weight: normal;
            margin-right: 15px;
            padding-right: 15px;
            border-right: 2px solid rgba(255,255,255,0.5);
            vertical-align: middle;
        }
        body.dark-mode #user-info {
            border-right-color: rgba(255,255,255,0.3);
        }

        /* --- STYLES ADMIN GESTION UTILISATEURS --- */
        #manage-users-button {
            background-color: #ffc107; /* Jaune distinctif */
            color: #333;
            font-weight: bold;
            display: none; /* Masqu√© par d√©faut */
        }
        #manage-users-button:hover { background-color: #e0a800; }

        body.dark-mode #manage-users-button {
            background-color: #b38600;
            color: white;
        }
        body.dark-mode #manage-users-button:hover { background-color: #997300; }

        /* Styles pour la liste dans la modale de gestion */
        #user-list {
            list-style-type: none;
            padding-left: 0;
            max-height: 400px; /* Limite la hauteur si bcp d'utilisateurs */
            overflow-y: auto;
            margin-top: 15px;
        }
        #user-list li {
            background: #f4f4f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px 15px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        #user-list li strong {
            font-size: 1.1em;
            color: #333;
        }
        #user-list li div {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        #user-list .balance-input {
            width: 100px;
            font-size: 1em;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #user-list .set-balance-btn {
            padding: 5px 10px;
            font-size: 0.9em;
            cursor: pointer;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        #user-list .set-balance-btn:hover { background: #1e7e34; }

        /* Mode sombre pour la liste */
        body.dark-mode #user-list li {
            background: #3a4b5c;
            border-color: #555;
        }
        body.dark-mode #user-list li strong {
            color: #fff;
        }
        body.dark-mode #user-list .balance-input {
            background: #555;
            color: #fff;
            border-color: #777;
        }
        /* --- FIN STYLES ADMIN --- */

        /* ---------- Styles Panel D√©mo ---------- */
        #demo-panel {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 320px;
            max-width: calc(100% - 40px);
            background: rgba(255,255,255,0.98);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.25);
            padding: 12px;
            z-index: 1200;
            transition: transform 0.25s ease, opacity 0.25s ease;
            font-family: Arial, sans-serif;
        }
        #demo-panel.hidden { transform: translateY(130%); opacity: 0; pointer-events: none; }
        #demo-toggle-btn {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background: linear-gradient(135deg,#007bff,#0056b3);
            color: #fff;
            padding: 12px 16px;
            border-radius: 50px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 1300;
            font-weight: bold;
            border: none;
        }
        #demo-panel h3 { margin: 6px 0 10px 0; font-size: 1.05em; color: #333; }
        #demo-panel .demo-row { display:flex; gap:8px; align-items:center; margin:8px 0; }
        #demo-panel button.demo-btn {
            padding:8px 10px;
            border-radius:6px;
            border:none;
            cursor:pointer;
            background:#007bff;
            color:#fff;
            font-weight:bold;
        }
        #demo-panel button.secondary { background:#6c757d; }
        #demo-panel button.warn { background:#dc3545; }
        #demo-panel .small { padding:6px 8px; font-size:0.9em; }
        #demo-panel p { margin:6px 0; font-size:0.95em; color:#333; }

        @media (max-width:520px) {
            #demo-panel { width: 92%; right: 4%; left:4%; }
            #demo-toggle-btn { right: 10px; bottom: 10px; }
        }
        /* ---------- fin panel d√©mo ---------- */

    </style>
<script src="database.js"></script>
</head>
<body><audio autoplay="" id="bg-music" loop="" preload="auto" src="sounds/casino-music-jazz-las-vegas-monaco-background-intro-theme-294408.mp3"></audio><audio id="s-spin" preload="auto" src="sounds/slot-machine-reels-sound-30276_ZFxVLP0I.mp3"></audio><audio id="s-stop" preload="auto" src="sounds/.mp3"></audio><audio id="s-win" preload="auto"src="sounds/Slot Machine Jackpot Sound Effect.mp3"></audio><div id="audio-gate" style="position: fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:3000;">
<div class="card" style="background:#07132a; color:#e6eef8; padding:18px 22px; border-radius:12px; text-align:center; max-width:90%; box-shadow:0 10px 30px rgba(0,0,0,.35);">
<div>Appuyez pour activer les sons</div>
<button id="enable-audio-btn" style="margin-top:10px; padding:10px 16px; border:none; border-radius:8px; cursor:pointer; font-weight:700; background:#00aaff; color:#07132a;">Activer le son</button>
</div>
</div>
<div id="auth-container">
<h2>Bienvenue sur la Machine √† Sous</h2>
<p>Veuillez vous connecter ou cr√©er un compte pour jouer.</p>
<button id="login-button">Connexion</button>
<button id="register-button">Cr√©er un compte</button>
</div>
<div id="game-container" style="display: none;">
<div id="balance-container">
<span id="user-info"></span>
            üí∞ Solde : <span id="balance-display">0.00</span> ‚Ç¨
            <button id="recharge-button" onclick="rechargeBalance()">Recharger (100 ‚Ç¨)</button>
<button id="rules-button" onclick="showRules()">‚ÑπÔ∏è R√®gles</button>
<button id="settings-button" onclick="showSettings()">‚öôÔ∏è Param√®tres</button>
<button id="cheat-button" onclick="activateCheatMode()">Admin</button>
<button id="test-button" onclick="runTests()">Test</button>
<button id="manage-users-button">G√©rer Comptes</button>
<button id="logout-button">D√©connexion</button>
</div>
<a href="Index.html" id="back-button">‚¨Ö Retour</a>
<div id="slot-container">
<div id="reels-container">
<div class="symbol" id="symbol-0-0">S1</div>
<div class="symbol" id="symbol-1-0">S1</div>
<div class="symbol" id="symbol-2-0">S1</div>
<div class="symbol" id="symbol-3-0">S1</div>
<div class="symbol" id="symbol-4-0">S1</div>
<div class="symbol" id="symbol-0-1">S2</div>
<div class="symbol" id="symbol-1-1">S2</div>
<div class="symbol" id="symbol-2-1">S2</div>
<div class="symbol" id="symbol-3-1">S2</div>
<div class="symbol" id="symbol-4-1">S2</div>
<div class="symbol" id="symbol-0-2">S3</div>
<div class="symbol" id="symbol-1-2">S3</div>
<div class="symbol" id="symbol-2-2">S3</div>
<div class="symbol" id="symbol-3-2">S3</div>
<div class="symbol" id="symbol-4-2">S3</div>
</div>
</div>
<div id="bet-controls">
<button id="decrease-bet">-</button>
<input id="bet-input" max="25.00" min="1.00" step="1.00" type="number" value="5.00"/>
<button id="increase-bet">+</button>
</div>
<div id="result-display">Cliquez sur SPIN pour jouer !</div>
<div id="frenzy-display"></div>
<button id="spin-button" onclick="startSpin()">SPIN</button>
<div id="test-log">
<strong>R√©sultats des tests :</strong>
<ul id="test-results"></ul>
</div>
</div>
<div class="modal-overlay" id="rules-modal">
<div class="modal-content">
<span class="modal-close" onclick="hideRules()">√ó</span>
<h2>R√®gles du Jeu</h2>
<p>Alignez des symboles identiques sur les <strong>lignes horizontales (5x)</strong>, les <strong>colonnes (3x)</strong>, ou en <strong>formes (V, Z, A)</strong> pour gagner !</p>
<p>Obtenez 3 symboles üåü (Scatter) ou plus n'importe o√π sur la grille pour d√©clencher <strong>10 Tours Gratuits</strong> en Mode Fr√©n√©sie !</p>
<h3>Multiplicateurs de Gains :</h3>
<ul id="payout-list"></ul>
</div>
</div>
<div class="modal-overlay" id="settings-modal">
<div class="modal-content">
<span class="modal-close" onclick="hideSettings()">√ó</span>
<h2>Param√®tres</h2>
<h3>Th√®me</h3>
<button id="dark-mode-toggle">Activer le Mode Sombre</button>
</div>
</div>
<div class="modal-overlay" id="user-management-modal">
<div class="modal-content">
<span class="modal-close" onclick="hideUserManagement()">√ó</span>
<h2>Gestion des Utilisateurs</h2>
<p>Modifier le solde des utilisateurs. Les modifications sont sauvegard√©es imm√©diatement.</p>
<ul id="user-list">
</ul>
</div>
</div>
<button id="demo-toggle-btn" title="Ouvrir le panneau d√©mo">DEMO</button>
<div aria-hidden="true" class="hidden" id="demo-panel">
<h3>Panel D√©mo</h3>
<p>Outils pour tester rapidement (invit√©, cr√©dits, spin garanti).</p>
<div class="demo-row">
<button class="demo-btn small" onclick="guestLogin()">Se connecter en Invit√©</button>
<button class="demo-btn small secondary" onclick="guestLogout()">Quitter Invit√©</button>
</div>
<div class="demo-row">
<button class="demo-btn small" onclick="demoAdjustBalance(10)">+10 ‚Ç¨</button>
<button class="demo-btn small" onclick="demoAdjustBalance(50)">+50 ‚Ç¨</button>
<button class="demo-btn small warn" onclick="demoAdjustBalance(-10)">-10 ‚Ç¨</button>
</div>
<div class="demo-row">
<button class="demo-btn small" onclick="setGuaranteedWin()">Spin gagnant garanti (prochain spin)</button>
</div>
<p><small>Le spin garanti rendra la ligne du milieu gagnante (S10x5) au prochain SPIN.</small></p>
</div>
<script>
        // --- CONSTANTES DU JEU ---
        const MAX_BALANCE = 100.00;
        const MIN_BET = 1.00, MAX_BET = 25.00, BET_STEP = 1.00, DEFAULT_BET = 5.00;

        // ========= MODIFI√â : D√©finition des Symboles et Raret√© =========
        // S1 (commun) -> S10 (rare/jackpot)
        
        // Mode Normal : S1 est commun, S10 est tr√®s rare.
        const SYMBOLS = [
            "S1", "S1", "S1", "S1", "S1", "S1", "S1", "S1", // 8x
            "S2", "S2", "S2", "S2", "S2", "S2", "S2",     // 7x
            "S3", "S3", "S3", "S3", "S3", "S3",             // 6x
            "S4", "S4", "S4", "S4", "S4",                 // 5x
            "S5", "S5", "S5", "S5",                     // 4x
            "S6", "S6", "S6",                         // 3x
            "S7", "S7",                             // 2x
            "S8",                                 // 1x
            "S9",                                 // 1x
            "S10",                                // 1x (Jackpot)
            "üåü", "üåü"                            // 2x (Scatter)
        ]; // Total 40

        // Mode Fr√©n√©sie : Les symboles rares (S7-S10) sont plus communs.
        const SYMBOLS_FRENZY = [
            "S1",                                 // 1x
            "S2",                                 // 1x
            "S3", "S3",                             // 2x
            "S4", "S4", "S4",                         // 3x
            "S5", "S5", "S5", "S5",                     // 4x
            "S6", "S6", "S6", "S6", "S6",                 // 5x
            "S7", "S7", "S7", "S7", "S7",                 // 5x
            "S8", "S8", "S8", "S8",                     // 4x
            "S9", "S9", "S9",                         // 3x
            "S10", "S10",                           // 2x (Jackpot)
            "üåü", "üåü", "üåü"                        // 3x (Scatter)
        ]; // Total 33

        // Gains pour 5 symboles (Lignes / Formes)
        // Remplacez "liens image.png" par le chemin de vos images (ex: "images/S1.png")
        const PAYOUTS = { 
            "S1": 5,    // S1 = "images/chanvillard gta5.png"
            "S2": 10,   // S2 = "images/guille gta5.png"
            "S3": 20,   // S3 = "images/bouguelia gta5.png"
            "S4": 40,   // S4 = "images/goldfarb gta5.png"
            "S5": 80,   // S5 = "images/fisquet gta5.png"
            "S6": 150,  // S6 = "images/agoun gta5.png"
            "S7": 300,  // S7 = "images/boubou gta5.png"
            "S8": 600,  // S8 = "images/lhomme gta5.png"
            "S9": 1200, // S9 = "images/rassel gta5.png"
            "S10": 5000 // S10 = "images/ouzrout gta5.png" (Jackpot)
        };
        
        // Gains pour 3 symboles (Colonnes)
        const PAYOUTS_3 = { 
            "S1": 5,    // S1 = "images/chanvillard gta5.png"
            "S2": 10,   // S2 = "images/guille gta5.png"
            "S3": 20,   // S3 = "images/bouguelia gta5.png"
            "S4": 40,   // S4 = "images/goldfarb gta5.png"
            "S5": 80,   // S5 = "images/fisquet gta5.png"
            "S6": 150,  // S6 = "images/agoun gta5.png"
            "S7": 300,  // S7 = "images/boubou gta5.png"
            "S8": 600,  // S8 = "images/lhomme gta5.png"
            "S9": 1200, // S9 = "images/rassel gta5.png"
            "S10": 5000, // S10 = "images/ouzrout gta5.png" (Jackpot)
            "üåü": 0     // üåü = "liens scatter.png"
        };

        document.addEventListener("DOMContentLoaded", () => {
  // === MAPPING SYMBOLS -> IMAGES ===
  const map = {
    "S1": "images/S1.png",   // chanvillard gta5.png
    "S2": "images/S2.png",   // guille gta5.png
    "S3": "images/S3.png",   // bouguelia gta5.png
    "S4": "images/S4.png",   // goldfarb gta5.png
    "S5": "images/S5.png",   // fisquet gta5.png
    "S6": "images/S6.png",   // agoun gta5.png
    "S7": "images/S7.png",   // boubou gta5.png
    "S8": "images/S8.png",   // lhomme gta5.png
    "S9": "images/S9.png",   // rassel gta5.png
    "S10": "images/S10.png", // ouzrout gta5.png
    "üåü": "images/scatter.png"
  };

    // === FONCTION QUI MET LES IMAGES ===
    function updateSymbols() {
        document.querySelectorAll(".symbol").forEach(el => {
        const symbol = el.textContent.trim();
        if (map[symbol]) {
            el.style.backgroundImage = `url("${map[symbol]}")`;
            el.setAttribute("data-symbol", symbol);
            el.style.color = "transparent"; // cache le texte
        }
        });
    }

    // === 1re mise √† jour au chargement ===
    updateSymbols();

    // === Observer les changements pour mettre √† jour pendant le spin ===
    const observer = new MutationObserver(updateSymbols);
    const reels = document.getElementById("reels-container");
    if (reels) {
        observer.observe(reels, {
        childList: true,
        subtree: true,
        characterData: true
        });
    }
    });

        // ========= FIN MODIFICATIONS Symboles =========


        // --- CONSTANTES D'AUTH ---
        // (Note: ADMIN_EMAIL est maintenant d√©fini dans database.js)
        const STORAGE_USERS_KEY = "slot_users";
        const STORAGE_CURRENT_USER_KEY = "slot_currentUserEmail";

        // --- VARIABLES D'√âTAT DU JEU ---
        let userBalance = 0.00;
        let currentBet = DEFAULT_BET;
        let activeCheatMode = "none"; // "none", "jackpot", "scatter"
        let animationInterval;
        let isFrenzyModeActive = false;
        let frenzySpinsRemaining = 0;
        const FRENZY_SPINS_AWARDED = 10;

        // --- VARIABLES D'√âTAT D'AUTH ---
        let allUsers = [];
        let currentUser = null;

        // --- D√âMO / GUEST ---
        let guaranteedWinNextSpin = false; // si true -> prochain spin sera gagnant (ligne milieu S10x5)
        let isGuest = false;

        // --- S√âLECTION DES √âL√âMENTS DU DOM ---
        const balanceDisplay = document.getElementById('balance-display');
        const spinButton = document.getElementById('spin-button');
        const resultDisplay = document.getElementById('result-display');
        const betInput = document.getElementById('bet-input');
        const decreaseBetButton = document.getElementById('decrease-bet');
        const increaseBetButton = document.getElementById('increase-bet');
        const testButton = document.getElementById('test-button');
        const rulesModal = document.getElementById('rules-modal');
        const payoutList = document.getElementById('payout-list');
        const frenzyDisplay = document.getElementById('frenzy-display');

        const settingsModal = document.getElementById('settings-modal');
        const darkModeToggleButton = document.getElementById('dark-mode-toggle');
        const authContainer = document.getElementById('auth-container');
        const gameContainer = document.getElementById('game-container');
        const loginButton = document.getElementById('login-button');
        const registerButton = document.getElementById('register-button');
        const logoutButton = document.getElementById('logout-button');
        const userInfoDisplay = document.getElementById('user-info');
        const cheatButton = document.getElementById('cheat-button');
        // NOUVELLES S√âLECTIONS ADMIN
        const manageUsersButton = document.getElementById('manage-users-button');
        const userManagementModal = document.getElementById('user-management-modal');
        const userList = document.getElementById('user-list');

        // Demo UI
        const demoToggleBtn = document.getElementById('demo-toggle-btn');
        const demoPanel = document.getElementById('demo-panel');

        // ===============================================
        // FONCTIONS D'AUTHENTIFICATION
        // ===============================================

        function initializeApp() {
            loadAllUsers();
            checkLoginState();
            updateUI();
            applySavedTheme();

            loginButton.addEventListener('click', login);
            registerButton.addEventListener('click', register);
            logoutButton.addEventListener('click', logout);
            darkModeToggleButton.addEventListener('click', toggleDarkMode);

            // NOUVEAUX √âV√âNEMENTS ADMIN
            manageUsersButton.addEventListener('click', showUserManagement);
            userManagementModal.addEventListener('click', function (event) {
                if (event.target === userManagementModal) { hideUserManagement(); }
            });
            // Utiliser la d√©l√©gation d'√©v√©nements pour la liste
            userList.addEventListener('click', handleUserListClick);

            // D√©mo toggle
            demoToggleBtn.addEventListener('click', toggleDemoPanel);
            demoPanel.addEventListener('click', function (e) { e.stopPropagation(); });
            document.addEventListener('click', function(e){
                // close demo if clicked outside and panel open
                if(!demoPanel.classList.contains('hidden') && !demoPanel.contains(e.target) && e.target !== demoToggleBtn){
                    hideDemoPanel();
                }
            });
        }

        /**
         * Charge la liste des utilisateurs depuis localStorage.
         * Si localStorage est vide, utilise DEFAULT_USERS (de database.js).
         */
        function loadAllUsers() {
            const usersJSON = localStorage.getItem(STORAGE_USERS_KEY);
            if (usersJSON) {
                allUsers = JSON.parse(usersJSON);
            } else {
                allUsers = (typeof DEFAULT_USERS !== 'undefined') ? DEFAULT_USERS : [];
                saveAllUsers();
            }
        }

        function checkLoginState() {
            const currentUserEmail = localStorage.getItem(STORAGE_CURRENT_USER_KEY);
            if (currentUserEmail) {
                currentUser = allUsers.find(user => user.email === currentUserEmail) || null;
                isGuest = false;
            }
        }

        function updateUI() {
            if (currentUser) {
                authContainer.style.display = 'none';
                gameContainer.style.display = 'block';
                userBalance = currentUser.balance;
                updateBalanceDisplay();
                updateBet(currentBet);
                userInfoDisplay.textContent = currentUser.name;

                // 'ADMIN_EMAIL' est disponible car database.js a √©t√© charg√©
                // MODIFI√â pour inclure le bouton de gestion
                if (typeof ADMIN_EMAIL !== 'undefined' && currentUser.email === ADMIN_EMAIL) {
                    cheatButton.style.display = 'inline-block';
                    manageUsersButton.style.display = 'inline-block';
                } else {
                    cheatButton.style.display = 'none';
                    manageUsersButton.style.display = 'none';
                }

            } else if (isGuest) {
                // Afficher UI m√™me si invit√©
                authContainer.style.display = 'none';
                gameContainer.style.display = 'block';
                updateBalanceDisplay();
                updateBet(currentBet);
                userInfoDisplay.textContent = "Invit√©";
                cheatButton.style.display = 'none';
                manageUsersButton.style.display = 'none';
            } else {
                authContainer.style.display = 'block';
                gameContainer.style.display = 'none';
                userBalance = 0;
                currentUser = null;
                isGuest = false;
            }
        }

        function saveAllUsers() {
            localStorage.setItem(STORAGE_USERS_KEY, JSON.stringify(allUsers));
        }

        function saveCurrentUserBalance() {
            if (currentUser && !isGuest) {
                currentUser.balance = userBalance;
                const userIndex = allUsers.findIndex(u => u.email === currentUser.email);
                if (userIndex > -1) {
                    allUsers[userIndex].balance = userBalance;
                    saveAllUsers();
                }
            }
        }

        function login() {
            const email = prompt("Entrez votre e-mail pour vous connecter :");
            if (!email) return;

            const user = allUsers.find(u => u.email.toLowerCase() === email.toLowerCase());

            if (user) {
                localStorage.setItem(STORAGE_CURRENT_USER_KEY, user.email);
                location.reload();
            } else {
                alert("Compte non trouv√©. Veuillez cr√©er un compte.");
            }
        }

        function register() {
            const name = prompt("Entrez votre nom :");
            if (!name) return;
            const email = prompt("Entrez votre e-mail :");
            if (!email) return;

            const emailExists = allUsers.some(u => u.email.toLowerCase() === email.toLowerCase());

            if (emailExists) {
                alert("Cet e-mail est d√©j√† utilis√©. Veuillez vous connecter.");
                return;
            }

            const newUser = {
                name: name,
                email: email,
                balance: MAX_BALANCE
            };
            allUsers.push(newUser);
            saveAllUsers();

            localStorage.setItem(STORAGE_CURRENT_USER_KEY, newUser.email);
            location.reload();
        }

        function logout() {
            localStorage.removeItem(STORAGE_CURRENT_USER_KEY);
            // si c'√©tait un invit√©, clear guest
            isGuest = false;
            currentUser = null;
            location.reload();
        }

        // ===============================================
        // NOUVELLES FONCTIONS DE GESTION ADMIN
        // ===============================================

        function showUserManagement() {
            userList.innerHTML = ''; // Vider la liste pr√©c√©dente

            // Parcourir tous les utilisateurs
            allUsers.forEach(user => {
                // Ne pas afficher l'admin lui-m√™me dans la liste
                if (typeof ADMIN_EMAIL !== 'undefined' && user.email === ADMIN_EMAIL) return;

                const li = document.createElement('li');
                li.innerHTML = `
                    <strong>${user.name}</strong> (${user.email})<br>
                    Solde actuel : <strong>${user.balance.toFixed(2)} ‚Ç¨</strong>
                    <div>
                        <input type="number" class="balance-input" value="${user.balance.toFixed(2)}" step="10" min="0">
                        <button class="set-balance-btn" data-email="${user.email}">D√©finir Solde</button>
                    </div>
                `;
                userList.appendChild(li);
            });

            userManagementModal.style.display = 'flex';
        }

        function hideUserManagement() {
            userManagementModal.style.display = 'none';
        }

        /**
         * G√®re le clic sur un bouton "D√©finir Solde" dans la modale de gestion
         */
        function handleUserListClick(e) {
            // V√©rifier si on a cliqu√© sur un bouton de sauvegarde
            if (e.target.classList.contains('set-balance-btn')) {
                const email = e.target.dataset.email;
                // Trouver l'input associ√© √† ce bouton
                const input = e.target.previousElementSibling;
                const newBalance = parseFloat(input.value);

                if (isNaN(newBalance) || newBalance < 0) {
                    alert("Veuillez entrer un solde valide (nombre positif).");
                    return;
                }

                // Mettre √† jour le solde et sauvegarder
                updateUserBalance(email, newBalance);
            }
        }

        /**
         * Met √† jour le solde d'un utilisateur sp√©cifique et sauvegarde
         */
        function updateUserBalance(email, newBalance) {
            const userToUpdate = allUsers.find(u => u.email === email);
            if (userToUpdate) {
                userToUpdate.balance = newBalance;
                saveAllUsers(); // Sauvegarde la liste compl√®te mise √† jour dans localStorage
                
                // Optionnel : rafra√Æchir la liste pour confirmer visuellement
                const btn = userList.querySelector(`button[data-email="${email}"]`);
                if (btn) {
                    const balanceDisplay = btn.closest('li').querySelector('strong:last-of-type');
                    balanceDisplay.textContent = `${newBalance.toFixed(2)} ‚Ç¨`;
                    btn.previousElementSibling.value = newBalance.toFixed(2);
                }
                
                alert(`Le solde de ${userToUpdate.name} a √©t√© mis √† jour.`);

            } else {
                alert("Erreur : Utilisateur non trouv√©.");
            }
        }

        // ===============================================
        // FONCTIONS DU JEU
        // ===============================================

        /**
         * NOUVELLE FONCTION DE CALCUL DES GAINS (MODIFI√âE)
         * Calcule la totalit√© des gains pour une grille donn√©e.
         * V√©rifie les lignes, colonnes et formes sp√©ciales (V, Z, A).
         * RETOURNE MAINTENANT 'winningCoords'
         */
        function calculateTotalWinnings(grid, bet) {
            let totalWinnings = 0;
            let winningLinesDesc = [];
            let isJackpotWin = false;
            let winningCoords = new Set(); // NOUVEAU: Stocke les coordonn√©es "r-c"
            const R = 3; // rows
            const C = 5; // columns

            // Helper pour ajouter des coordonn√©es
            const addCoords = (r, c) => winningCoords.add(`${r}-${c}`);

            // 1. V√©rification des Lignes Horizontales (Gains 5x)
            for (let r = 0; r < R; r++) {
                const firstSymbol = grid[r][0];
                if (PAYOUTS[firstSymbol] === undefined) continue; 

                let isFullLine = true;
                for (let c = 1; c < C; c++) {
                    if (grid[r][c] !== firstSymbol) {
                        isFullLine = false;
                        break;
                    }
                }
                if (isFullLine) {
                    const multiplier = PAYOUTS[firstSymbol];
                    totalWinnings += bet * multiplier;
                    const lineName = (r === 0) ? "Ligne Haut" : (r === 1) ? "Ligne Milieu" : "Ligne Bas";
                    winningLinesDesc.push(`${lineName} (${firstSymbol})`);
                    
                    // MODIFI√â : V√©rifie le Jackpot S10
                    if (firstSymbol === "S10") isJackpotWin = true;

                    // NOUVEAU : Ajouter les coordonn√©es
                    for (let c_win = 0; c_win < C; c_win++) {
                        addCoords(r, c_win);
                    }
                }
            }

            // 2. V√©rification des Colonnes Verticales (Gains 3x)
            for (let c = 0; c < C; c++) {
                const firstSymbol = grid[0][c];
                if (PAYOUTS_3[firstSymbol] === undefined || PAYOUTS_3[firstSymbol] === 0) continue; 

                let isFullColumn = true;
                for (let r = 1; r < R; r++) {
                    if (grid[r][c] !== firstSymbol) {
                        isFullColumn = false;
                        break;
                    }
                }
                if (isFullColumn) {
                    const multiplier = PAYOUTS_3[firstSymbol];
                    totalWinnings += bet * multiplier;
                    winningLinesDesc.push(`Colonne ${c+1} (${firstSymbol})`);
                    
                    // NOUVEAU : Ajouter les coordonn√©es
                    for (let r_win = 0; r_win < R; r_win++) {
                        addCoords(r_win, c);
                    }
                }
            }

            // 3. V√©rification des Formes (Gains 5x)

            // Forme V: [0,0], [1,1], [2,2], [1,3], [0,4]
            const vSymbols = [grid[0][0], grid[1][1], grid[2][2], grid[1][3], grid[0][4]];
            const firstVSymbol = vSymbols[0];
            if (PAYOUTS[firstVSymbol] && vSymbols.every(s => s === firstVSymbol)) {
                totalWinnings += bet * PAYOUTS[firstVSymbol];
                winningLinesDesc.push(`Forme V (${firstVSymbol})`);
                
                // MODIFI√â : V√©rifie le Jackpot S10
                if (firstVSymbol === "S10") isJackpotWin = true;
                
                // NOUVEAU : Ajouter les coordonn√©es
                addCoords(0, 0); addCoords(1, 1); addCoords(2, 2); addCoords(1, 3); addCoords(0, 4);
            }

            // Forme Z: [0,0], [0,1], [1,2], [2,3], [2,4]
            const zSymbols = [grid[0][0], grid[0][1], grid[1][2], grid[2][3], grid[2][4]];
            const firstZSymbol = zSymbols[0];
            if (PAYOUTS[firstZSymbol] && zSymbols.every(s => s === firstZSymbol)) {
                totalWinnings += bet * PAYOUTS[firstZSymbol];
                winningLinesDesc.push(`Forme Z (${firstZSymbol})`);
                
                // MODIFI√â : V√©rifie le Jackpot S10
                if (firstZSymbol === "S10") isJackpotWin = true;

                // NOUVEAU : Ajouter les coordonn√©es
                addCoords(0, 0); addCoords(0, 1); addCoords(1, 2); addCoords(2, 3); addCoords(2, 4);
            }
            
            // Forme Z-Inverse: [2,0], [2,1], [1,2], [0,3], [0,4]
            const revZSymbols = [grid[2][0], grid[2][1], grid[1][2], grid[0][3], grid[0][4]];
            const firstRevZSymbol = revZSymbols[0];
            if (PAYOUTS[firstRevZSymbol] && revZSymbols.every(s => s === firstRevZSymbol)) {
                totalWinnings += bet * PAYOUTS[firstRevZSymbol];
                winningLinesDesc.push(`Forme Z-inv (${firstRevZSymbol})`);
                
                // MODIFI√â : V√©rifie le Jackpot S10
                if (firstRevZSymbol === "S10") isJackpotWin = true;

                // NOUVEAU : Ajouter les coordonn√©es
                addCoords(2, 0); addCoords(2, 1); addCoords(1, 2); addCoords(0, 3); addCoords(0, 4);
            }

            // Forme A (V invers√©): [2,0], [1,1], [0,2], [1,3], [2,4]
            const aSymbols = [grid[2][0], grid[1][1], grid[0][2], grid[1][3], grid[2][4]]; 
            const firstASymbol = aSymbols[0];
            if (PAYOUTS[firstASymbol] && aSymbols.every(s => s === firstASymbol)) {
                totalWinnings += bet * PAYOUTS[firstASymbol];
                winningLinesDesc.push(`Forme A (${firstASymbol})`);
                
                // MODIFI√â : V√©rifie le Jackpot S10
                if (firstASymbol === "S10") isJackpotWin = true;

                // NOUVEAU : Ajouter les coordonn√©es
                addCoords(2, 0); addCoords(1, 1); addCoords(0, 2); addCoords(1, 3); addCoords(2, 4);
            }

            // MODIFI√â : Retourner aussi les coordonn√©es
            return { totalWinnings, winningLinesDesc: [...new Set(winningLinesDesc)], isJackpotWin, winningCoords };
        }


        /**
         * FONCTION showRules MISE A JOUR
         */
        function showRules() {
            payoutList.innerHTML = ''; // Vider la liste
            
            // Modifier le texte principal (le premier <p> dans la modale)
            const p = rulesModal.querySelector('.modal-content p');
            p.innerHTML = "Alignez des symboles identiques sur les <strong>lignes horizontales (5x)</strong>, les <strong>colonnes (3x)</strong>, ou en <strong>formes (V, Z, A)</strong> pour gagner !";

            // Ajoute un titre pour les gains 5x
            const h5x = document.createElement('li');
            h5x.innerHTML = "<strong>--- Gains (5 symboles) ---</strong>";
            h5x.style.background = "none";
            h5x.style.marginTop = "10px";
            payoutList.appendChild(h5x);

            // Affiche les gains 5x (PAYOUTS)
            // MODIFI√â : Tri par symbole (S1, S2...) au lieu de valeur
            const sortedPayouts = Object.entries(PAYOUTS).sort(([keyA], [keyB]) => {
                const numA = parseInt(keyA.substring(1));
                const numB = parseInt(keyB.substring(1));
                return numA - numB;
            });
            for (const [symbol, multiplier] of sortedPayouts) {
                const li = document.createElement('li');
                li.innerHTML = `<span>${symbol}</span> x 5 (Lignes, V, Z, A) = <strong>${multiplier}x</strong> la mise`;
                payoutList.appendChild(li);
            }
            
            // Ajoute un titre pour les gains 3x
            const h3x = document.createElement('li');
            h3x.innerHTML = "<strong>--- Gains (3 symboles) ---</strong>";
            h3x.style.background = "none";
            h3x.style.marginTop = "10px";
            payoutList.appendChild(h3x);

            // Affiche les gains 3x (PAYOUTS_3)
            // MODIFI√â : Tri par symbole
            const sortedPayouts3 = Object.entries(PAYOUTS_3)
                .filter(([key, multiplier]) => multiplier > 0 && key !== 'üåü') // Ne pas montrer üåü ici
                .sort(([keyA], [keyB]) => {
                    const numA = parseInt(keyA.substring(1));
                    const numB = parseInt(keyB.substring(1));
                    return numA - numB;
                });
                
            for (const [symbol, multiplier] of sortedPayouts3) {
                const li = document.createElement('li');
                li.innerHTML = `<span>${symbol}</span> x 3 (Colonnes) = <strong>${multiplier}x</strong> la mise`;
                payoutList.appendChild(li);
            }

            // Affiche le gain de Scatter
            const li = document.createElement('li');
            li.style.marginTop = "10px";
            li.innerHTML = `<span>üåü</span> x 3 (ou plus) n'importe o√π = <strong>${FRENZY_SPINS_AWARDED} Tours Fr√©n√©sie</strong>`;
            payoutList.appendChild(li);
            
            rulesModal.style.display = 'flex';
        }
        function hideRules() { rulesModal.style.display = 'none'; }
        rulesModal.addEventListener('click', function (event) {
            if (event.target === rulesModal) { hideRules(); }
        });

        function showSettings() { settingsModal.style.display = 'flex'; }
        function hideSettings() { settingsModal.style.display = 'none'; }
        settingsModal.addEventListener('click', function (event) {
            if (event.target === settingsModal) { hideSettings(); }
        });

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            
            if (document.body.classList.contains('dark-mode')) {
                darkModeToggleButton.textContent = "D√©sactiver le Mode Sombre";
                localStorage.setItem('slotMachineTheme', 'dark');
            } else {
                darkModeToggleButton.textContent = "Activer le Mode Sombre";
                localStorage.setItem('slotMachineTheme', 'light');
            }
        }

        function applySavedTheme() {
            const savedTheme = localStorage.getItem('slotMachineTheme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                darkModeToggleButton.textContent = "D√©sactiver le Mode Sombre";
            } else {
                document.body.classList.remove('dark-mode');
                darkModeToggleButton.textContent = "Activer le Mode Sombre";
            }
        }

        function activateCheatMode() {
            const cheatBtn = document.getElementById('cheat-button');

            if (activeCheatMode !== "none") {
                activeCheatMode = "none";
                cheatBtn.textContent = "Admin";
                cheatBtn.style.backgroundColor = "#888";
                testButton.style.display = "none";
                document.getElementById('test-log').style.display = "none";
                alert("Mode Cheat d√©sactiv√©.");
                return;
            }

            const password = prompt("Entrez le mot de passe administrateur :");
            const correctPassword = "938-555-0100";

            if (password === correctPassword) {
                // MODIFI√â : Texte pour S10
                const choice = prompt("Quel cheat activer ?\n1 = Jackpot (S10x5)\n2 = Scatter (Fr√©n√©sie 100%)\n\nEntrez 1 ou 2 :");

                if (choice === "1") {
                    activeCheatMode = "jackpot";
                    // MODIFI√â : Texte pour S10
                    cheatBtn.textContent = "CHEAT: S10";
                    cheatBtn.style.backgroundColor = "#2ecc71";
                    testButton.style.display = "inline-block";
                    alert("Mode Jackpot activ√© ! Tous les spins seront des S10x5.");
                } else if (choice === "2") {
                    activeCheatMode = "scatter";
                    cheatBtn.textContent = "CHEAT: üåü";
                    cheatBtn.style.backgroundColor = "#2ecc71";
                    testButton.style.display = "inline-block";
                    alert("Mode Scatter activ√© ! 3+ Scatters garantis.");
                } else {
                    alert("Choix invalide.");
                }
            } else if (password) {
                alert("Mot de passe incorrect.");
            }
        }

        function updateBet(newBet) {
            if (newBet < MIN_BET) newBet = MIN_BET;
            if (newBet > MAX_BET) newBet = MAX_BET;
            if (!isFrenzyModeActive) {
                currentBet = newBet;
            }
            betInput.value = Math.round(currentBet);
            decreaseBetButton.disabled = (currentBet <= MIN_BET) || isFrenzyModeActive;
            increaseBetButton.disabled = (currentBet >= MAX_BET) || isFrenzyModeActive;
        }

        function changeBet(amount) { updateBet(currentBet + amount); }
        decreaseBetButton.addEventListener('click', () => changeBet(-BET_STEP));
        increaseBetButton.addEventListener('click', () => changeBet(BET_STEP));
        betInput.addEventListener('change', () => {
            let typedBet = parseFloat(betInput.value);
            if (isNaN(typedBet)) typedBet = DEFAULT_BET;
            typedBet = Math.round(typedBet / BET_STEP) * BET_STEP;
            updateBet(typedBet);
        });

        function updateBalanceDisplay() { balanceDisplay.textContent = userBalance.toFixed(2); }

        function adjustBalance(amount) {
            userBalance += amount;
            if (userBalance < 0) userBalance = 0;
            updateBalanceDisplay();
            saveCurrentUserBalance();
            updateBet(currentBet);
            if (userBalance <= 0 && !isFrenzyModeActive) {
                resultDisplay.textContent = "Solde √©puis√© ! Veuillez recharger.";
                resultDisplay.classList.add('lose');
            }
        }

        function rechargeBalance() {
            if (userBalance <= 0) {
                let amountToRecharge = MAX_BALANCE - userBalance;
                adjustBalance(amountToRecharge);
                resultDisplay.textContent = "Solde recharg√© !";
                resultDisplay.classList.add('win');
            } else {
                resultDisplay.textContent = "Vous avez encore " + userBalance.toFixed(2) + " ‚Ç¨.";
                resultDisplay.classList.remove('win', 'lose', 'jackpot');
            }
            updateBalanceDisplay();
            updateBet(currentBet);
        }

        function getRandomSymbol() {
            const symbolList = isFrenzyModeActive ? SYMBOLS_FRENZY : SYMBOLS;
            return symbolList[Math.floor(Math.random() * symbolList.length)];
        }

        /**
         * FONCTION generateFinalGrid (MODIFI√âE)
         */
        function generateFinalGrid() {
            // Si on veut un spin garanti, produire une grille ad√©quate
            if (guaranteedWinNextSpin) {
                guaranteedWinNextSpin = false;
                // Produire une grille o√π la ligne du milieu est S10x5 (gros gain)
                let grid = [];
                for (let r = 0; r < 3; r++) {
                    let row = [];
                    for (let c = 0; c < 5; c++) {
                        // MODIFI√â : Utilise S10 au lieu de 7
                        if (r === 1) row.push("S10");
                        else row.push(getRandomSymbol());
                    }
                    grid.push(row);
                }
                return grid;
            }

            let grid = [];
            for (let r = 0; r < 3; r++) {
                let row = [];
                for (let c = 0; c < 5; c++) {
                    // Logique de Cheat
                    // MODIFI√â : Utilise S10 au lieu de 7
                    if (activeCheatMode === "jackpot" && (
                        (r === 1) || // Ligne milieu
                        [0,4].includes(c) || // Colonnes V/Z
                        (r === 2 && c === 2) // Centre V
                    )) {
                        row.push("S10");
                    } else if (activeCheatMode === "scatter" && ((r === 0 && c === 0) || (r === 1 && c === 2) || (r === 2 && c === 4))) {
                        row.push("üåü");
                    } else {
                        row.push(getRandomSymbol());
                    }
                }
                grid.push(row);
            }

            // Assurer que le Jackpot s'applique √† TOUTES les lignes si demand√© (pour test)
            if (activeCheatMode === "jackpot") {
                // MODIFI√â : Utilise S10 au lieu de 7
                grid[0] = ["S10", "S10", "S10", "S10", "S10"];
                grid[1] = ["S10", "S10", "S10", "S10", "S10"];
                grid[2] = ["S10", "S10", "S10", "S10", "S10"];
            }

            return grid;
        }

        function stopColumn(colIndex, finalGrid, spinningColumns) {
            spinningColumns.shift();
            for (let r = 0; r < 3; r++) {
                const symbolEl = document.getElementById(`symbol-${colIndex}-${r}`);
                
                // MODIFI√â : Affiche le texte du symbole
                symbolEl.textContent = finalGrid[r][colIndex];
                
                /* // === ASTUCE POUR LES IMAGES ===
                // Si vous voulez utiliser des images (ex: "S1.png"), 
                // remplacez la ligne ci-dessus par celle-ci :
                
                const symbol = finalGrid[r][colIndex];
                if (symbol === "üåü") {
                    symbolEl.innerHTML = `<img src="images/scatter.png" alt="Scatter">`;
                } else {
                    symbolEl.innerHTML = `<img src="images/${symbol}.png" alt="${symbol}">`;
                }
                // (Assurez-vous aussi d'ajuster le CSS de .symbol et .symbol img)
                // === FIN ASTUCE ===
                */

                symbolEl.classList.remove('spinning');
            }
        }

        function runSpinAnimation(spinningColumns) {
            for (const colIndex of spinningColumns) {
                for (let r = 0; r < 3; r++) {
                    const symbolEl = document.getElementById(`symbol-${colIndex}-${r}`);
                    
                    // MODIFI√â : Affiche le texte du symbole
                    symbolEl.textContent = getRandomSymbol();

                    /*
                    // === ASTUCE POUR LES IMAGES (animation) ===
                    // (Utilisez la m√™me logique que stopColumn pour l'animation)
                    const symbol = getRandomSymbol();
                    if (symbol === "üåü") {
                        symbolEl.innerHTML = `<img src="images/scatter.png" alt="Scatter">`;
                    } else {
                        symbolEl.innerHTML = `<img src="images/${symbol}.png" alt="${symbol}">`;
                    }
                    // === FIN ASTUCE ===
                    */
                }
            }
        }

        function countScatters(grid) {
            let count = 0;
            for (let r = 0; r < 3; r++) {
                for (let c = 0; c < 5; c++) {
                    if (grid[r][c] === "üåü") {
                        count++;
                    }
                }
            }
            return count;
        }

        function startFrenzyMode() {
            if (!isFrenzyModeActive) {
                isFrenzyModeActive = true;
            }
            frenzySpinsRemaining += FRENZY_SPINS_AWARDED;
            document.body.classList.add('frenzy-mode');
            updateFrenzyDisplay();
            decreaseBetButton.disabled = true;
            increaseBetButton.disabled = true;
            betInput.disabled = true;
        }

        function endFrenzyMode() {
            isFrenzyModeActive = false;
            frenzySpinsRemaining = 0;
            document.body.classList.remove('frenzy-mode');
            updateFrenzyDisplay();
            betInput.disabled = false;
            updateBet(currentBet);
        }

        function updateFrenzyDisplay() {
            if (isFrenzyModeActive && frenzySpinsRemaining > 0) {
                frenzyDisplay.textContent = `Tours Fr√©n√©sie : ${frenzySpinsRemaining}`;
                frenzyDisplay.style.display = 'block';
            } else {
                frenzyDisplay.style.display = 'none';
            }
        }

        /**
         * FONCTION startSpin (MODIFI√âE)
         */
        function startSpin() {
            // NOUVEAU : Effacer les surbrillances du tour pr√©c√©dent
            document.querySelectorAll('.symbol.winning-symbol').forEach(el => {
                el.classList.remove('winning-symbol');
            });

            if (!isFrenzyModeActive) {
                if (userBalance < currentBet) { resultDisplay.textContent = "Solde insuffisant !"; resultDisplay.classList.add('lose'); return; }
                adjustBalance(-currentBet);
                resultDisplay.textContent = "Les rouleaux tournent...";
            } else {
                frenzySpinsRemaining--;
                updateFrenzyDisplay();
                resultDisplay.textContent = "Tour Fr√©n√©sie !";
            }

            spinButton.disabled = true;
            if (!isFrenzyModeActive) {
                decreaseBetButton.disabled = true;
                increaseBetButton.disabled = true;
                betInput.disabled = true;
            }
            resultDisplay.classList.remove('win', 'lose', 'jackpot');

            const finalGrid = generateFinalGrid();
            let spinningColumns = [0, 1, 2, 3, 4];

            document.querySelectorAll('.symbol').forEach(s => s.classList.add('spinning'));
            animationInterval = setInterval(() => runSpinAnimation(spinningColumns), 100);

            setTimeout(() => stopColumn(0, finalGrid, spinningColumns), 1000);
            setTimeout(() => stopColumn(1, finalGrid, spinningColumns), 1500);
            setTimeout(() => stopColumn(2, finalGrid, spinningColumns), 2000);
            setTimeout(() => stopColumn(3, finalGrid, spinningColumns), 2500);
            setTimeout(() => {
                stopColumn(4, finalGrid, spinningColumns);
                clearInterval(animationInterval);

                // ==================================
                // LOGIQUE DE GAINS (MODIFI√âE)
                // ==================================

                // MODIFI√â : R√©cup√©rer les 'winningCoords'
                const { totalWinnings, winningLinesDesc, isJackpotWin, winningCoords } = calculateTotalWinnings(finalGrid, currentBet);
                let hasWon = totalWinnings > 0; // Flag pour la logique d'affichage

                // Compter les scatters
                const scatterCount = countScatters(finalGrid);

                // 1. G√©rer les gains de lignes/formes
                if (hasWon) {
                    adjustBalance(totalWinnings);
                    
                    if (isJackpotWin) {
                        resultDisplay.textContent = `üéâ JACKPOT !!! +${totalWinnings.toFixed(2)} ‚Ç¨ !`;
                        resultDisplay.classList.add('jackpot');
                    } else {
                        let desc = winningLinesDesc.join(', ');
                        if (desc.length > 50) {
                            desc = `${winningLinesDesc.length} lignes gagnantes`;
                        }
                        resultDisplay.textContent = `Gagn√© ! +${totalWinnings.toFixed(2)} ‚Ç¨ (${desc})`;
                        resultDisplay.classList.add('win');
                    }
                    
                    // NOUVEAU : Appliquer le surbrillance pour les lignes/formes
                    winningCoords.forEach(coord => {
                        const [r, c] = coord.split('-').map(Number);
                        const symbolEl = document.getElementById(`symbol-${c}-${r}`);
                        if (symbolEl) {
                            symbolEl.classList.add('winning-symbol');
                        }
                    });

                } else if (scatterCount < 3) { 
                    resultDisplay.textContent = "Pas de chance... Essayez encore !";
                    resultDisplay.classList.add('lose');
                }

                // 2. G√©rer les gains de Scatters (Fr√©n√©sie)
                if (scatterCount >= 3) {
                    let scatterMsg = `üåü ${scatterCount} SCATTERS ! üåü +${FRENZY_SPINS_AWARDED} Tours Fr√©n√©sie !`;
                    if (hasWon) {
                        resultDisplay.textContent += " " + scatterMsg;
                    } else {
                        resultDisplay.textContent = scatterMsg;
                        resultDisplay.classList.remove('lose');
                        resultDisplay.classList.add('win');
                    }
                    
                    // NOUVEAU : Mettre aussi les scatters en surbrillance
                    for (let r = 0; r < 3; r++) {
                        for (let c = 0; c < 5; c++) {
                            if (finalGrid[r][c] === "üåü") {
                                const symbolEl = document.getElementById(`symbol-${c}-${r}`);
                                if (symbolEl) {
                                    symbolEl.classList.add('winning-symbol');
                                }
                            }
                        }
                    }

                    startFrenzyMode();
                }

                // ==================================
                // FIN DE LA LOGIQUE
                // ==================================

                if (isFrenzyModeActive && frenzySpinsRemaining <= 0) {
                    endFrenzyMode();
                    if (!hasWon && scatterCount < 3) {
                        resultDisplay.textContent = "Mode Fr√©n√©sie termin√© !";
                    }
                }

                spinButton.disabled = false;
                if (!isFrenzyModeActive) {
                    betInput.disabled = false;
                    updateBet(currentBet);
                }
            }, 3000);
        }

        function assert(desc, cond) {
            const li = document.createElement('li');
            li.textContent = desc + ' ‚Üí ' + (cond ? '‚úÖ OK' : '‚ùå √âchec');
            li.style.color = cond ? 'green' : 'red';
            document.getElementById('test-results').appendChild(li);
        }

        /**
         * FONCTION runTests (MODIFI√âE)
         */
        function runTests() {
            const log = document.getElementById('test-log');
            log.style.display = 'block';
            document.getElementById('test-results').innerHTML = '';

            assert('Solde initial charg√©', userBalance > 0);
            assert('Mise par d√©faut correcte', currentBet === DEFAULT_BET);
            assert('Bouton SPIN activ√©', !spinButton.disabled);

            activeCheatMode = "jackpot";
            const gridJackpot = generateFinalGrid();
            // MODIFI√â : Teste S10 au lieu de 7
            assert('Mode Cheat [Jackpot] g√©n√®re S10x5 Ligne 1', gridJackpot[0].every(s => 'S10' === s));
            assert('Mode Cheat [Jackpot] g√©n√®re S10x5 Ligne 2', gridJackpot[1].every(s => 'S10' === s));
            assert('Mode Cheat [Jackpot] g√©n√®re S10x5 Ligne 3', gridJackpot[2].every(s => 'S10' === s));

            activeCheatMode = "scatter";
            const gridScatter = generateFinalGrid();
            const scatterCount = countScatters(gridScatter);
            assert('Mode Cheat [Scatter] g√©n√®re >= 3 scatters', scatterCount >= 3);
            activeCheatMode = "none";
        }

        // ========== Fonctions D√©mo / Guest ==========

        function toggleDemoPanel() {
            if (demoPanel.classList.contains('hidden')) {
                demoPanel.classList.remove('hidden');
                demoPanel.setAttribute('aria-hidden', 'false');
            } else {
                hideDemoPanel();
            }
        }
        function hideDemoPanel() {
            demoPanel.classList.add('hidden');
            demoPanel.setAttribute('aria-hidden', 'true');
        }

        function guestLogin() {
            // Cr√©er un utilisateur invit√© non persistant
            isGuest = true;
            currentUser = null; // ne pas utiliser la persistence utilisateur normale
            userBalance = 50.00; // solde d'essai
            updateUI();
            updateBalanceDisplay();
            resultDisplay.textContent = "Connect√© en tant qu'Invit√© (solde: 50 ‚Ç¨)";
            resultDisplay.classList.add('win');
        }

        function guestLogout() {
            if (isGuest) {
                isGuest = false;
                currentUser = null;
                userBalance = 0;
                updateUI();
                resultDisplay.textContent = "Invit√© d√©connect√©.";
            } else {
                alert("Vous n'√™tes pas connect√© en invit√©.");
            }
        }

        function demoAdjustBalance(amount) {
            if (!isGuest && !currentUser) {
                alert("Connectez-vous d'abord (Invit√© ou compte).");
                return;
            }
            adjustBalance(amount);
            resultDisplay.textContent = (amount >= 0 ? "+" : "") + amount.toFixed(2) + " ‚Ç¨ appliqu√©.";
            resultDisplay.classList.add('win');
        }

        function setGuaranteedWin() {
            if (!isGuest && !currentUser) {
                alert("Connectez-vous d'abord (Invit√© ou compte).");
                return;
            }
            guaranteedWinNextSpin = true;
            // MODIFI√â : Texte pour S10
            resultDisplay.textContent = "Spin garanti activ√© : prochain SPIN donnera une ligne gagnante (S10x5).";
            resultDisplay.classList.add('win');
            hideDemoPanel();
        }

        // --- Point d'entr√©e ---
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script><script>
// === AUDIO INTEGRATION ADDED AUTOMATICALLY ===
(function(){
  try {
    const bgMusic = document.getElementById('bg-music');
    const sSpin = document.getElementById('s-spin');
    const sStop = document.getElementById('s-stop');
    const sWin = document.getElementById('s-win');
    const gate = document.getElementById('audio-gate');
    const enableBtn = gate ? gate.querySelector('#enable-audio-btn') : null;
    let audioUnlocked = false;

    function unlockAudio() {
      audioUnlocked = true;
      if (bgMusic) {
        bgMusic.volume = 0.6;
        // try play but ignore errors
        bgMusic.play().catch(()=>{});
      }
      if (gate) gate.style.display = 'none';
    }

    // If there is an enable button, wire it
    if (enableBtn) {
      enableBtn.addEventListener('click', function(e){
        e.stopPropagation();
        unlockAudio();
      });
    }

    // fallback: unlock on first user gesture (click/keydown/touchstart) once
    function gestureUnlock() {
      if (!audioUnlocked) unlockAudio();
      removeListeners();
    }
    function removeListeners() {
      document.removeEventListener('click', gestureUnlock);
      document.removeEventListener('keydown', gestureUnlock);
      document.removeEventListener('touchstart', gestureUnlock);
    }
    document.addEventListener('click', gestureUnlock, { once: true });
    document.addEventListener('keydown', gestureUnlock, { once: true });
    document.addEventListener('touchstart', gestureUnlock, { once: true });

    // Wrap startSpin if it exists
    if (typeof startSpin === 'function') {
      const _oldStartSpin = startSpin;
      startSpin = function() {
        try { if (sSpin) { sSpin.currentTime = 0; sSpin.play().catch(()=>{}); } } catch(e){}
        return _oldStartSpin.apply(this, arguments);
      };
    }

    // If there is an endSpin function, call sStop there
    if (typeof endSpin === 'function') {
      const _oldEndSpin = endSpin;
      endSpin = function() {
        try { if (sStop) { sStop.currentTime = 0; sStop.play().catch(()=>{}); } } catch(e){}
        return _oldEndSpin.apply(this, arguments);
      };
    }

    // MutationObserver on #result-display to detect win/lose classes
    const resultEl = document.getElementById('result-display');
    if (resultEl && (sStop || sWin)) {
      const mo = new MutationObserver((list) => {
        list.forEach(m => {
          if (m.attributeName === 'class') {
            const cls = resultEl.className || '';
            if (/jackpot|win/i.test(cls)) {
              try { if (sWin) { sWin.currentTime = 0; sWin.play().catch(()=>{}); } } catch(e){}
            } else if (/lose/i.test(cls)) {
              try { if (sStop) { sStop.currentTime = 0; sStop.play().catch(()=>{}); } } catch(e){}
            }
          }
        });
      });
      mo.observe(resultEl, { attributes: true, attributeFilter: ['class'] });
    }

    // Additionally, observe text changes for phrases "gagn" (gagne/gagn√©) to play win
    if (resultEl && sWin && sStop) {
      const mo2 = new MutationObserver((list) => {
        list.forEach(m => {
          if (m.type === 'childList' || m.type === 'characterData') {
            const txt = resultEl.textContent || '';
            if (/gagn/i.test(txt) || /jackpot/i.test(txt)) {
              try { sWin.currentTime = 0; sWin.play().catch(()=>{}); } catch(e){}
            } else if (/perd/i.test(txt) || /d√©sol√©/i.test(txt)) {
              try { sStop.currentTime = 0; sStop.play().catch(()=>{}); } catch(e){}
            }
          }
        });
      });
      mo2.observe(resultEl, { childList: true, characterData: true, subtree: true });
    }

    // Expose small helper functions in window to allow manual calls from game code
    window.__playStopSound = function(){ try{ if (sStop) sStop.play().catch(()=>{});}catch(e){} };
    window.__playWinSound = function(){ try{ if (sWin) sWin.play().catch(()=>{});}catch(e){} };
    window.__playSpinSound = function(){ try{ if (sSpin) sSpin.play().catch(()=>{});}catch(e){} };

  } catch (e) {
    console.error('Audio integration failed', e);
  }
})();
</script>
</body>
</html>