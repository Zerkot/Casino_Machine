<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test Unitaire - Pop-up Advertisement</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; padding: 20px; }
    h1 { color: #007bff; }
    ul { list-style-type: none; padding: 0; }
    li { margin-bottom: 10px; font-size: 1.2em; }
    .ok { color: green; }
    .fail { color: red; }
</style>
</head>
<body>

<h1>Tests Automatiques : Pop-up Advertisement / Rechargement</h1>
<ul id="test-results"></ul>

<script>
    // --- Variables et fonctions simulant ton slot ---
    let userBalance = 100.00;
    const MAX_BALANCE = 100.00;

    function updateBalanceDisplay() { /* dummy */ }

    function adjustBalance(amount) {
        userBalance += amount;
        if (userBalance < 0) userBalance = 0;
        updateBalanceDisplay();
    }

    function rechargeBalance() {
        if (userBalance <= 0) {
            userBalance = MAX_BALANCE;
            alert("Solde rechargé ! Vous avez de nouveau " + MAX_BALANCE.toFixed(2) + " €.");
        }
        updateBalanceDisplay();
    }

    // --- Helper de test ---
    function assert(desc, condition) {
        const li = document.createElement('li');
        li.textContent = desc + " → " + (condition ? "✅ OK" : "❌ Échec");
        li.className = condition ? "ok" : "fail";
        document.getElementById('test-results').appendChild(li);
    }

    // --- Tests automatiques ---
    (function runTests() {
        let alertMessages = [];

        // Interception de window.alert
        const originalAlert = window.alert;
        window.alert = (msg) => { alertMessages.push(msg); };

        // Test 1 : recharge avec solde > 0 ne doit pas afficher le pop-up
        userBalance = 50;
        alertMessages = [];
        rechargeBalance();
        assert("Aucun pop-up si solde > 0", alertMessages.length === 0);

        // Test 2 : recharge avec solde = 0 doit afficher le pop-up
        userBalance = 0;
        alertMessages = [];
        rechargeBalance();
        assert("Pop-up affiché si solde = 0", alertMessages.includes("Solde rechargé ! Vous avez de nouveau 100.00 €."));
        assert("Solde remis à 100 après recharge", userBalance === MAX_BALANCE);

        // Test 3 : recharge avec solde < 0 doit afficher le pop-up et remettre à 100
        userBalance = -20;
        alertMessages = [];
        rechargeBalance();
        assert("Pop-up affiché si solde < 0", alertMessages.includes("Solde rechargé ! Vous avez de nouveau 100.00 €."));
        assert("Solde remis à 100 après recharge", userBalance === MAX_BALANCE);

        // Restaurer alert
        window.alert = originalAlert;
    })();
</script>

</body>
</html>
